Listview.templates.spell={entityType:WH.Types.SPELL,sort:["name","skill","level"],mode:WH.User.hasRole(U_GROUP_STAFF)&&!WH.isRetailTree()?Listview.MODE_CHECKBOX:Listview.MODE_DEFAULT,searchable:1,filtrable:1,completionText:Listview.getCompletionText(Listview.COMPLETION_TYPE_COLLECTION),columns:[{id:"name",name:WH.TERMS.name,type:"text",align:"left",span:2,value:"name",compute:function(e,t,a){let r=WH.ce("td",{style:{width:"44px",padding:"3px 0 3px 12px",borderRight:"none"}});let s;if(e.creates!=null){let t=parseInt(e.creates[1]);let a=parseInt(e.creates[2]);s=g_items.createIcon(e.creates[0],1,t||a?t+(a&&a!==t?"-"+a:""):"")}else if(e.taughtby!=null&&g_items[e.taughtby]){s=g_items.createIcon(e.taughtby,1);e.quality=g_items[e.taughtby].quality}else{s=g_spells.createIcon(e.id,1)}s.style.cssFloat=s.style.styleFloat="left";WH.ae(r,s);WH.ae(a,r);t.style.borderLeft="none";let l=WH.ce("div");let i=WH.ce("a",{className:"listview-cleartext",href:this.getItemLink(e)});if(!e.name){WH.error("Spell has no name! Using a placeholder.",e);e.name=WH.Entity.getPlaceholderName(WH.Types.SPELL,e.id)}if(e.displayName){i.innerHTML=e.displayName}else{WH.ae(i,WH.ct(e.name))}if(e.hasOwnProperty("quality")){i.classList.add("q"+e.quality)}if(e.frommerge){i.classList.add("icon-merge-right")}if(e.tooltipSpec){i.dataset.wowhead="spec="+e.tooltipSpec}WH.ae(l,i);let n=e.conduitRank;if(n!==undefined){n=WH.Strings.sprintf(WH.GlobalStrings.TRADESKILL_RANK_HEADER,n+1)}else{n=e.rank}if(n){let e=WH.ce("div");e.className="small2";WH.ae(e,WH.ct(n));WH.ae(l,e)}if(this.showRecipeClass&&e.reqclass){let t=WH.ce("div",{className:"small2"});let a=WH.Wow.PlayerClass.getAll().filter((function(t){return e.reqclass&1<<t-1}));for(let e=0,r=a.length;e<r;++e){if(e>0){WH.ae(t,WH.ct(WH.TERMS.comma_punct))}let r=WH.Wow.PlayerClass.getName(a[e]);WH.ae(t,WH.ce("a",{className:"c"+a[e],href:WH.Entity.getUrl(WH.Types.PLAYER_CLASS,a[e],r)},WH.ct(r)))}WH.ae(l,t)}let o;if(e.nameInfo){o=WH.ce("div",undefined,WH.ct(e.nameInfo))}if(e.id>g_spells.WH_IDS){o=WH.ce("div",undefined,WH.ct(WH.TERMS.unreleasedspell))}if(e.reqrace){let t=WH.Wow.Race.getSide(e.reqrace);if(t){o=WH.ce("div",undefined,WH.ct(g_sides[t]))}else{o=WH.ce("div",{className:"q1"});let t=WH.Wow.Race.getIdsFromMask(e.reqrace);for(let e=0,a=t.length;e<a;++e){if(e>0){WH.ae(o,WH.ct(WH.TERMS.comma_punct))}WH.ae(o,WH.ce("a",{href:WH.Entity.getUrl(WH.Types.RACE,t[e],WH.Wow.Race.getName(t[e]))},WH.ct(WH.Wow.Race.getName(t[e]))))}}}if(o){l.style.position="relative";o.classList.add("listview-name-info");WH.aef(l,o)}WH.ae(t,l)},getVisibleText:function(e){var t=e.name;if(e.rank){t+=" "+e.rank}if(e.conduitRank){t+=" "+e.conduitRank}if(e.reqclass){t+=WH.Wow.PlayerClass.getAll().filter((function(t){return e.reqclass&1<<t-1})).map(WH.Wow.PlayerClass.getName).join(WH.TERMS.comma_punct)}if(e.reqrace){t+=" "+WH.Wow.Race.getIdsFromMask(e.reqrace).map(WH.Wow.Race.getName).join(" ")}if((e.reqrace&1791)==1101){t+=" "+g_sides[1]}else if((e.reqrace&1791)==690){t+=" "+g_sides[2]}return t}},{id:"level",name:WH.TERMS.level,width:"10%",value:"level",compute:function(e,t){if(e.level>0){return e.level}},hidden:true},{id:"trainingcost",name:WH.TERMS.cost,width:"10%",hidden:true,getValue:function(e){if(e.trainingcost){return e.trainingcost}},compute:function(e,t){if(e.trainingcost){WH.ae(t,WH.Wow.buildMoney({copper:e.trainingcost}))}},sortFunc:function(e,t){if(e.trainingcost==null){return-1}else if(t.trainingcost==null){return 1}if(e.trainingcost<t.trainingcost){return-1}else if(e.trainingcost>t.trainingcost){return 1}return 0}},{id:"classes",name:WH.TERMS.classes,type:"text",hidden:true,width:"20%",getVisibleText:function(e){return WH.Wow.PlayerClass.getAll().filter((function(t){return e.reqclass&1<<t-1})).map(WH.Wow.PlayerClass.getName).join(WH.TERMS.comma_punct)},compute:function(e,t){if(e.reqclass){let i=WH.Wow.PlayerClass.getAll().filter((function(t){return e.reqclass&1<<t-1}));var a=WH.ce("div");a.style.width=26*i.length+"px";a.style.margin="0 auto";for(var r=0,s=i.length;r<s;++r){var l=Icon.create(WH.Wow.PlayerClass.getIconName(i[r]),0,null,WH.Entity.getUrl(WH.Types.PLAYER_CLASS,i[r],WH.Wow.PlayerClass.getName(i[r])));l.style.cssFloat=l.style.styleFloat="left";$(l).mouseover(function(e){return function(t){WH.Tooltip.showAtCursor(t,e,"q")}}(WH.Wow.PlayerClass.getName(i[r]))).mousemove((function(e){WH.Tooltip.cursorUpdate(e)})).mouseout((function(){WH.Tooltip.hide()}));WH.ae(a,l)}WH.ae(t,a)}},sortFunc:function(e,t){const a=WH.Wow.PlayerClass;let r=a.getAll().filter((function(t){return e.reqclass&1<<t-1}));let s=a.getAll().filter((function(e){return t.reqclass&1<<e-1}));let l=Math.max(r.length,s.length);for(let e=0;e<l;e++){if(r.length<=e){return-1}if(s.length<=e){return 1}let t=WH.stringCompare(a.getName(r[e]),a.getName(s[e]));if(t!==0){return t}}return 0}},{id:"singleclass",name:WH.TERMS["class"],type:"text",hidden:true,width:"15%",compute:function(e,t){const a=WH.Wow.PlayerClass;if(e.reqclass){let l=a.getAll().filter((function(t){return e.reqclass&1<<t-1}));var r=l[0];var s=$("<a>").css("background-image",'url("'+WH.staticUrl+"/images/wow/icons/tiny/"+a.getIconName(r)+'.gif")').addClass("icontiny tinyspecial").addClass("c"+r).attr("href",WH.Entity.getUrl(WH.Types.PLAYER_CLASS,r,a.getName(r))).text(a.getName(r));$(t).append(s)}},sortFunc:function(e,t){const a=WH.Wow.PlayerClass;let r=a.getAll().filter((function(t){return e.reqclass&1<<t-1}));let s=a.getAll().filter((function(e){return t.reqclass&1<<e-1}));let l=Math.max(r.length,s.length);for(let e=0;e<l;e++){if(r.length<=e){return-1}if(s.length<=e){return 1}let t=WH.stringCompare(a.getName(r[e]),a.getName(s[e]));if(t!==0){return t}}return 0}},{id:"glyphtype",name:WH.TERMS.glyphtype_stc,type:"text",hidden:true,width:"10%",compute:function(e,t){if(e.glyphtype){return WH.Wow.Glyph.getTypeName(e.glyphtype)}}},{id:"guildlevel",name:WH.TERMS.guildlevel,width:"10%",value:"guildlevel",compute:function(e,t){if(e.guildlevel>0){return e.guildlevel}},hidden:true},{id:"schools",name:WH.TERMS.school,type:"text",width:"10%",hidden:true,compute:function(e,t){var a="";var r=e.schools?e.schools:e.school;for(var s=0;s<32;++s){if(!(r&1<<s)){continue}if(a!=""){a+=", "}a+=WH.Wow.Spell.getSchoolName(s)}return a},sortFunc:function(e,t){return WH.stringCompare(this.compute(e),this.compute(t))}},{id:"type",name:WH.TERMS.type,type:"text",width:"14%",hidden:true,compute:function(e,t){var a=WH.ce("div");a.className="small";if(WH.inArray([7,-2,-7,-12,-11,-13,-14,-16,-17,-18],e.cat)!=-1){var r=WH.ce("a");r.className="q0";r.href=WH.Url.generatePath("/spells="+e.cat);WH.ae(r,WH.ct(g_spell_categories[e.cat]));WH.ae(a,r);WH.ae(a,WH.ce("br"));if(e.talentspec){var s=0,l;for(var i=0,n=e.talentspec.length;i<n;++i){var o=e.talentspec[i]&65535;if(this._wowClass&&WH.inArray(g_chr_specs_by_class[this._wowClass],o)==-1){continue}let t=WH.Wow.PlayerClass.Specialization.getName(o);if(!t){continue}if(s++>0){WH.ae(a,WH.ct(WH.TERMS.comma_punct))}l=e.reqclass||e.chrclass;if(l){l=1+Math.log(e.reqclass)/Math.LN2}else{for(var c in g_chr_specs_by_class){if(!g_chr_specs_by_class.hasOwnProperty(c)){continue}if(WH.inArray(g_chr_specs_by_class[c],o)>=0){l=c;break}}}var W=WH.ce("a");W.className="q1";W.href=WH.Url.generatePath("/spells="+e.cat+"."+l+"."+o);WH.ae(W,WH.ct(t));WH.ae(a,W)}if(s==0){l=e.reqclass||e.chrclass;if(l){WH.Wow.PlayerClass.getAll().forEach((function(t){if((l&Math.pow(2,parseInt(t,10)-1))!=0){if(s++>0){WH.ae(a,WH.ct(WH.TERMS.comma_punct))}var r=WH.ce("a");r.className="q1";r.href=WH.Url.generatePath("/spells="+e.cat+"."+t);WH.ae(r,WH.ct(WH.Wow.PlayerClass.getName(t)));WH.ae(a,r)}}))}}}else if(e.cat===WH.Wow.Skill.CATEGORY_PROFICIENCIES){let t=WH.Wow.Spell.getProficiencyNameFromFlags(e.type);if(t){WH.ae(a,WH.ce("a",{className:"q1",href:WH.Url.generatePath("/spells/proficiencies")+"?filter=22;"+WH.Wow.Spell.getProficiencyFilterSelectFromFlags(e.type)+";0"},WH.ct(t)))}}else if(e.reqclass){var W=WH.ce("a");W.className="q1";W.href=WH.Url.generatePath("/spells="+e.cat+"."+(1+Math.log(e.reqclass)/Math.LN2))+(WH.Wow.Glyph.getTypeName(e.glyphtype)?"?filter=gl="+e.glyphtype:"");WH.ae(W,WH.ct((WH.Wow.Glyph.getTypeName(e.glyphtype)?WH.Wow.Glyph.getTypeName(e.glyphtype)+" ":"")+WH.Wow.PlayerClass.getName(Math.round(1+Math.log(e.reqclass)/Math.LN2))));WH.ae(a,W)}}else if(g_spell_categories[e.cat]){var r=WH.ce("a");r.className="q1";r.href=WH.Url.generatePath("/spells="+e.cat);WH.ae(r,WH.ct(g_spell_categories[e.cat]));WH.ae(a,r)}WH.ae(t,a)},getVisibleText:function(e){var t=g_spell_categories[e.cat];if(WH.inArray([7,-2,-12,-11,-13,-14,-16,-17,-18],e.cat)!=-1){if(e.talentspec){let a=e.talentspec;(Array.isArray(a)?a:[a]).forEach((function(e){t+=" "+WH.Wow.PlayerClass.Specialization.getName(e)}))}else if(e.cat===WH.Wow.Skill.CATEGORY_PROFICIENCIES){t+=" "+WH.Wow.Spell.getProficiencyNameFromFlags(e.type)}else{if(WH.Wow.Glyph.getTypeName(e.glyphtype)){t+=" "+WH.Wow.Glyph.getTypeName(e.glyphtype)}t+=" "+WH.Wow.PlayerClass.getName(Math.round(1+Math.log(e.reqclass)/Math.LN2))}}return t},sortFunc:function(e,t){let a=e.cat===WH.Wow.Skill.CATEGORY_PROFICIENCIES?WH.Wow.Spell.getProficiencyNameFromFlags(e.type):e.type;let r=t.cat===WH.Wow.Skill.CATEGORY_PROFICIENCIES?WH.Wow.Spell.getProficiencyNameFromFlags(t.type):t.type;return WH.stringCompare(e.cat,t.cat)||WH.stringCompare(a,r)}},{id:"reagents",name:WH.TERMS.reagents,getValue:function(e){return e.reagents?e.reagents.length:0},compute:function(e,t){let a=e.reagents;if(!a){return}t.style.padding="0";for(let e=0,r=a.length;e<r;e++){let r=a[e][0];let s=a[e][1];let l=g_items.createIcon(r,1,s);l.style.display="inline-block";WH.ae(t,l)}let r=e.optionalReagents||[];for(let e=0,a;a=r[e];e++){let e=WH.Icon.create(WH.staticUrl+WH.Wow.Spell.OPTIONAL_REAGENT_ICON_PATH,WH.Icon.SMALL,WH.Strings.sprintf("/items?filter=243;%d;0",a.id));e.style.display="inline-block";WH.Tooltip.simple(e,WH.Strings.sprintf(WH.TERMS.parens_format,a.description||WH.GlobalStrings.EMPTY_OPTIONAL_REAGENT_TOOLTIP_TITLE,"#"+a.id));WH.ae(t,e)}},sortFunc:function(e,t){var a=e.reagents!=null?e.reagents.length:0;var r=t.reagents!=null?t.reagents.length:0;if(a>0&&a==r){return WH.stringCompare(e.reagents.toString(),t.reagents.toString())}else{return WH.stringCompare(a,r)}}},{id:"source",name:WH.TERMS.source,type:"text",width:"12%",hidden:true,compute:function(e,t){if(e.source!=null){var a="";for(var r=0,s=e.source.length;r<s;++r){if(r>0){a+=WH.TERMS.comma_punct}a+=g_sources[e.source[r]]}return a}},sortFunc:function(e,t){return Listview.funcBox.assocArrCmp(e.source,t.source,g_sources)}},{id:"side",name:WH.TERMS.side,type:"text",hidden:true,compute:function(e,t){if(e.side&&e.side!=3){var a=WH.ce("span");a.className=e.side==1?"icon-alliance":"icon-horde";a.onmouseover=function(t){WH.Tooltip.showAtCursor(t,g_sides[e.side],"q")};a.onmousemove=WH.Tooltip.cursorUpdate;a.onmouseout=WH.Tooltip.hide;WH.ae(t,a)}},getVisibleText:function(e){if(e.side){return g_sides[e.side]}},sortFunc:function(e,t){return WH.stringCompare(g_sides[e.side],g_sides[t.side])}},{id:"itemsource",name:WH.TERMS.source,type:"text",hidden:true,compute:function(e,t){var a=g_items[e.taughtby];if(!a){return}if(this.iconSize==0){t.className="small"}if(a.attainable){return WH.TERMS.unavailable}else if(a.source!=null){if(a.source.length==1){WH.noWrap(t);var r=a.sourcemore?a.sourcemore[0]:{};if(r.t){var s=WH.ce("a");if(r.q!=null){s.className="q"+r.q}else{s.className="q1"}s.href=WH.Entity.getUrl(r.t,r.ti,r.n);s.style.whiteSpace="nowrap";if(r.icon){s.className+=" icontiny tinyspecial";s.style.backgroundImage='url("'+WH.staticUrl+"/images/wow/icons/tiny/"+r.icon.toLowerCase()+'.gif")'}WH.ae(s,WH.ct(r.n));WH.ae(t,s)}else{WH.ae(t,WH.ct(WH.Wow.Item.getSourceCategory(a.source[0],r)))}var l=WH.Wow.Item.getSourceDescription(a.source[0],r);if(this.iconSize!=0&&l!=null){var i=WH.ce("div");i.className="small2";if(l.pretext){WH.ae(i,WH.ct(l.pretext))}if(l.url){var s=WH.ce("a");s.className="q1";s.href=l.url;WH.ae(s,WH.ct(l.text));WH.ae(i,s)}else{WH.ae(i,WH.ct(l.text))}if(l.posttext){WH.ae(i,WH.ct(l.posttext))}WH.ae(t,i)}}else{var n="";for(var o=0,c=a.source.length;o<c;++o){if(o>0){n+=WH.TERMS.comma_punct}n+=g_sources[a.source[o]]}return n}}},getVisibleText:function(e){var t=g_items[e.taughtby];if(!t){return}if(t.attainable){return WH.TERMS.unavailable}else if(t.source!=null){if(t.source.length==1){var a="";var r=t.sourcemore?t.sourcemore[0]:{};if(r.t){a+=" "+r.n}else{a+=" "+WH.Wow.Item.getSourceCategory(t.source[0],r)}var s=WH.Wow.Item.getSourceDescription(t.source[0],r);if(s!=null){if(s.pretext){a+=" "+s.pretext}a+=" "+s.text;if(s.posttext){a+=" "+s.posttext}}return a}else{return Listview.funcBox.arrayText(t.source,g_sources)}}},sortFunc:function(e,t){var e=g_items[e.taughtby];var t=g_items[t.taughtby];if(!e||!t){return 0}var a=Listview.funcBox.assocArrCmp(e.source,t.source,g_sources);if(a!=0){return a}var r=e.sourcemore&&e.source.length==1?e.sourcemore[0].n:null,s=t.sourcemore&&t.source.length==1?t.sourcemore[0].n:null;return WH.stringCompare(r,s)}},{id:"branch",name:WH.TERMS.branch,type:"text",width:"10%",hidden:true,compute:function(e,t){if(e.project){if(e.project.branch){$(t).append(WH.Wow.Spell.getProjectBranchName(e.project.branch)+"<br>")}$(t).append("<small"+(!e.project.rarity?' class="q0"':"")+">"+e.projectRarityName+"</small>")}},getVisibleText:function(e){var t="";if(e.project){if(e.project.branch){t+=WH.Wow.Spell.getProjectBranchName(e.project.branch)+" "}t+=e.projectRarityName}return t},sortFunc:function(e,t){if(!e.project||!t.project){return e.project?1:t.project?-1:0}let a=WH.Wow.Spell.getProjectBranchName(e.project.branch);let r=WH.Wow.Spell.getProjectBranchName(t.project.branch);return WH.stringCompare(a,r)||-WH.stringCompare(e.project.rarity,t.project.rarity)}},{id:"fragments",name:WH.TERMS.fragments,type:"text",width:"10%",hidden:true,compute:function(e,t){if(e.project){let r=WH.Wow.Currency.getName(e.project.currency);let s=WH.Wow.Currency.getIcon(e.project.currency);let l=g_gatheredcurrencies[e.project.currency];if(l){r=l["name_"+Locale.getName()]||r;s=l.icon||s}var a=$("<a/>",{href:WH.Entity.getUrl(WH.Types.CURRENCY,e.project.currency),text:e.project.ncurrency});a.addClass("q1");a.addClass("icontinyr tip");a.css("background-image","url("+WH.staticUrl+"/images/wow/icons/tiny/"+s.toLowerCase()+".gif)");a.mouseover((function(e){WH.Tooltip.showAtCursor(e,r,"q")}));a.mousemove(WH.Tooltip.cursorUpdate);a.mouseout(WH.Tooltip.hide);$(t).append(a)}},sortFunc:function(e,t){if(!e.project||!t.project){return e.project?1:t.project?-1:0}return WH.stringCompare(e.project.ncurrency,t.project.ncurrency)||WH.stringCompare(e.project.currency,t.project.currency)}},{id:"keystone",name:WH.TERMS.keystone,type:"text",width:"10%",hidden:true,compute:function(e,t){if(e.project&&e.project.nkeystones&&g_items[e.project.keystone]){t.style.padding="0";var a=WH.ce("div");a.style.width="44px";a.style.margin="0 auto";WH.ae(a,g_items.createIcon(e.project.keystone,1,e.project.nkeystones));WH.ae(t,a)}},getVisibleText:function(e){if(e.project&&e.project.nkeystones&&g_items[e.project.keystone]){return g_items[e.project.keystone]["name_"+Locale.getName()]}},sortFunc:function(e,t){if(!e.project||!t.project){return e.project?1:t.project?-1:0}var a=e.project.nkeystones&&g_items[e.project.keystone]?g_items[e.project.keystone]["name_"+Locale.getName()]:"";var r=t.project.nkeystones&&g_items[t.project.keystone]?g_items[t.project.keystone]["name_"+Locale.getName()]:"";return WH.stringCompare(a,r)||WH.stringCompare(e.project.nkeystones,t.project.nkeystones)}},{id:"skill",name:WH.TERMS.skill,type:"text",width:"20%",getValue:function(e){return e.learnedat},compute:function(e,t,a,r){const s=WH.Wow.Skill;if(e.skill!=null){this.skillsColumn=r;var l=WH.ce("div"),i;l.className="small";for(var n=0,o=e.skill.length;n<o;++n){if(n>0){WH.ae(l,WH.ct(WH.TERMS.comma_punct))}if(e.skill[n]==-1){WH.ae(l,WH.ct(WH.TERMS.ellipsis_punct))}else{if(WH.inArray([-3,-5,-6,-7,11,9],e.cat)!=-1){var c="";if(e.cat==-3&&!e.reqclass){for(var W=0;W<mn_spells.length;W++){if(mn_spells[W][0]==-3){for(var u=0;u<mn_spells[W][3].length;u++){for(var p=0;p<mn_spells[W][3][u][3].length;p++){if(mn_spells[W][3][u][3][p][0]==e.skill[n]){c=mn_spells[W][3][u][0]+"."}}}}}}else if(e.reqclass)c=""+(1+Math.log(e.reqclass)/Math.LN2)+".";var i=WH.ce("a");i.className="q1";if(WH.inArray([-5,-6],e.cat)!=-1){i.href=WH.Url.generatePath("/spells="+e.cat)}else{i.href=WH.Url.generatePath("/spells="+e.cat+"."+c+e.skill[n])}var H=WH.getGets();var g=H.spells?H.spells.split("."):[false,false];if(e.reqclass&&(e.cat==7||e.cat==-2)){if(n<1&&1+Math.log(e.reqclass)/Math.LN2!=g[1]){var f=WH.ce("a");f.className="q0";f.href=WH.Url.generatePath("/spells="+e.cat+"."+(1+Math.log(e.reqclass)/Math.LN2));WH.ae(f,WH.ct(WH.Wow.PlayerClass.getName(Math.round(1+Math.log(e.reqclass)/Math.LN2))));WH.ae(l,f);WH.ae(l,WH.ce("br"))}}WH.ae(i,WH.ct(s.getName(e.skill[n])));WH.ae(l,i)}else if(WH.inArray([-2,7],e.cat)!=-1){var i=WH.ce("a");i.className="q1";i.href=WH.Url.generatePath("/spells="+e.cat+"."+(e.reqclass?1+Math.log(e.reqclass)/Math.LN2:""));WH.ae(i,WH.ct(s.getName(e.skill[n])));WH.ae(l,i)}else{WH.ae(l,WH.ct(s.getName(e.skill[n])))}}}if(e.specialization&&g_skill_specializations[e.specialization]){var m=i.href;if(m){i=WH.ce("a");i.className="q1";i.href=m+"."+e.specialization;WH.ae(l,WH.ct(": "));WH.ae(i,WH.ct(g_skill_specializations[e.specialization]));WH.ae(l,i)}else{WH.ae(l,WH.ct(": "+g_skill_specializations[e.specialization]))}}if(e.learnedat>0){WH.ae(l,WH.ct(" ("));var h=WH.ce("span");if(e.learnedat==9999){h.className="q0";WH.ae(h,WH.ct("??"))}else if(e.learnedat>0){WH.ae(h,WH.ct(e.learnedat));h.style.fontWeight="bold"}WH.ae(l,h);WH.ae(l,WH.ct(")"))}WH.ae(t,l);if(e.colors!=null){this.columns[r].type=null;var y=e.colors,d=0;for(var n=0;n<y.length;++n){if(y[n]>0){++d;break}}if(d>0){d=0;l=WH.ce("div");l.className="small";l.style.fontWeight="bold";for(var n=0;n<y.length;++n){if(y[n]>0){if(d++>0){WH.ae(l,WH.ct(" "))}var v=WH.ce("span");v.className="r"+(n+1);WH.ae(v,WH.ct(y[n]));WH.ae(l,v)}}WH.ae(t,l)}}}else{if(e.reqclass&&WH.inArray([-2,7],e.cat)!=-1){var l=WH.ce("div"),i;l.className="small";var i=WH.ce("a");i.className="q1";i.href=WH.Url.generatePath("/spells="+e.cat+"."+(e.reqclass?1+Math.log(e.reqclass)/Math.LN2:""));WH.ae(i,WH.ct(WH.Wow.PlayerClass.getName(Math.round(1+Math.log(e.reqclass)/Math.LN2))));WH.ae(l,i);WH.ae(t,l)}}},getVisibleText:function(e){let t="";if(e.skill){let a=Array.isArray(e.skill)?e.skill:[e.skill];t+=a.map(WH.Wow.Skill.getName).join(" ")}if(e.specialization){t+=" "+g_skill_specializations[e.specialization]}if(e.learnedat>0){t+=" "+(e.learnedat==9999?"??":e.learnedat)}return t},sortFunc:function(e,t){if(e.reqclass&&t.reqclass){var a=WH.stringCompare(WH.Wow.PlayerClass.getName(Math.round(1+Math.log(e.reqclass)/Math.LN2)),WH.Wow.PlayerClass.getName(Math.round(1+Math.log(t.reqclass)/Math.LN2)));if(a)return a}var r=[e.learnedat,t.learnedat];for(var s=0;s<2;++s){var l=s==0?e:t;if(r[s]==9999&&l.colors!=null){var i=0;while(l.colors[i]==0&&i<l.colors.length){i++}if(i<l.colors.length){r[s]=l.colors[i]}}}var n=WH.stringCompare(r[0],r[1]);if(n!=0)return n;if(e.colors!=null&&t.colors!=null){for(var i=0;i<4;++i){if(e.hasOwnProperty("colors")&&t.hasOwnProperty("colors")&&e.colors.hasOwnProperty(i)&&t.colors.hasOwnProperty(i)){n=WH.stringCompare(e.colors[i],t.colors[i])}if(n!=0)return n}}const o=WH.Wow.PlayerClass;let c=e.skill?Array.isArray(e.skill)?e.skill:[e.skill]:[];let W=t.skill?Array.isArray(t.skill)?t.skill:[t.skill]:[];let u=Math.max(c.length,W.length);for(let e=0;e<u;e++){if(c.length<=e){return-1}if(W.length<=e){return 1}let t=WH.stringCompare(o.getName(c[e]),o.getName(W[e]));if(t!==0){return t}}return 0}},{id:"skillup",name:WH.TERMS.skillpoints,width:"10%",value:"nskillup",compute:function(e,t){if(e.nskillup>0){return e.nskillup}},hidden:true},{id:Listview.COLUMN_ID_COMPLETION,name:WH.TERMS.completion,hidden:true,compute:function(e,t,a,r){if(!e.hasOwnProperty("cat")||!Listview.templates.spell._validCompletionCategory(e.cat)){return}WH.addCompletionIcons(t,WH.Types.SPELL,e.id)},sortFunc:function(e,t){return WH.stringCompare(WH.getCompletionFlags(WH.Types.SPELL,e.id),WH.getCompletionFlags(WH.Types.SPELL,t.id))},getValue:function(e){var t=0;var a=WH.User.Completion.getByType(WH.Types.SPELL);if(!e.hasOwnProperty("cat")||!Listview.templates.spell._validCompletionCategory(e.cat)){return-1}for(var r in g_user.lists){var s=g_user.lists[r];if(!(s.id in a)){continue}if(WH.inArray(a[s.id],e.id)!=-1){t++}}return t}}],getItemLink:function(e){let t="";if(e.conduitRank){t+="?rank="+e.conduitRank}return WH.Entity.getUrl(WH.Types.SPELL,e.id,e.name)+t},_validCompletionCategory:function(e){return WH.inArray(g_completion_categories[6],e)!=-1},createCbControls:WH.User.hasRole(U_GROUP_STAFF)&&!WH.isRetailTree()?function(e,t){if(!t){return}let a=WH.ce("button",{className:"btn-primary"},WH.ct("Set Phase"));WH.aE(a,"click",this.template.setPhase.bind(this));WH.ae(e,a)}:undefined,createTooltipToggle:function(e,t){if(!t)return;this.addTooltipToggle(e,g_spells)},onBeforeCreate:function(){for(var e in this.columns){if(this.columns[e].id=="completed"&&this.columns[e].hidden){if(!(this.hasOwnProperty("completionMode")&&this.completionMode)&&WH.isRetailTree()&&WH.isSet("g_user")&&"lists"in g_user&&WH.inArray(this.hiddenCols,this.columns[e].id)==-1){var t=0;for(var a in this.data){if(this.data[a].hasOwnProperty("cat")&&Listview.templates.spell._validCompletionCategory(this.data[a].cat)){t++}}if(t>this.data.length*.1){this.visibility.push(parseInt(e))}}}}},setPhase:function(){var e=this.getCheckedRows();if(!e.length){return}var t=[];for(var a=0;a<e.length;a++){t.push(e[a].id)}WH.Wow.showContentPhasePrompt(WH.Types.SPELL,t)}};